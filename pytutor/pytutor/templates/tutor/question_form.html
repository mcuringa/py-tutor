{% extends "base.html" %}

{% block title %}PyTutor::Question Editor{% endblock %}

{% block body %}
<div class="row">
    <div class="col-md-6">
        <section id="question-form">

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Question Editor <small>(id. {{pk}}, v. {{question.instance.version}})</h2>
                </div>
                <div class="panel-body">
                    <dl id="question-info" class="dl-horizontal">
                        <dt>Created by:</dt>
                        <dd>{{question.instance.creator}} on {{question.instance.created}}</dd>
                        <dt>Last modified by:</dt>
                        <dd>{{question.instance.modifier}} on {{question.instance.modified}}</dd>
                    </dl>
                </div>
            </div>
            <form action="/question/save" method="post" id="question-form" role="form">
                {% csrf_token %}
                <input type="hidden" name="pk" value="{{pk}}">
                <input type="hidden" id="id_prompt" name="prompt">
                <input type="hidden" id="id_solution" name="solution">
               
                <div class="form-group">
                    {{ question.function_name.errors }}
                    {{ question.function_name.label_tag }} 
                    {{ question.function_name }}
                    <p class="help-block">Enter the name of the function the studier <em>must</em> create.</p>
                </div>
                <div class="form-group">
                    {{ question.prompt.errors }}
                    {{ question.prompt.label_tag }}
                    <div id="prompt-editor" class="code-editor" data-code-field="prompt">{{question.instance.prompt}}</div>
                    <p class="help-block">Provide clear instructions and sample ouput where appropriate. This field accepts <tt>markdown</tt>.</p>
                </div>
                <div class="form-group">
                    {{ question.solution.errors }}
                    {{ question.solution.label_tag }}
                    <div id="solution-editor" class="code-editor" data-code-field="solution">{{question.instance.solution}}</div>
                    <p class="help-block">Write your solution Python code here. It <em>must</em> pass all of the tetsts.</p>
                </div>
                <div class="form-group">
                    {{ question.level.errors }}
                    {{ question.level.label_tag }} 
                    {{ question.level }} 
                </div>
                <div class="form-group">
                    {{ question.tags.errors }}
                    {{ question.tags.label_tag }} 
                    {{ question.tags }} 
                </div>
                <div class="form-group">
                    {{ question.comment.errors }}
                    {{ question.comment.label_tag }} 
                    {{ question.comment }} 
                </div>
                <button id="save-question" class="btn btn-success">Save</button>
                <a href="/question/{{question.instance.id}}/delete" class="btn btn-danger">Delete Question</a>
            </form>
        </section>
    </div>
    <div class="col-md-6">
        <ul id="question-edit-tabs" class="nav nav-tabs" role="tablist">
          <li class="active"><a href="#tests" role="tab" data-toggle="tab">Test Cases</a></li>
          <li><a href="#history" role="tab" data-toggle="tab">View History</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active panel panel-default" id="tests">
                <header class="panel-heading">
                    <h2 class="panel-title">Add Tests</h2>
                </header>
                <div class="panel-body">
                    <form id="test-form" class="" action="/question/test/save" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="question_id" value="{{pk}}">
                        <div class="form-group">
                            {{ test_form.args.label_tag }} 
                            {{ test_form.args }}
                            <p class="help-text">
                                Valid Python arguments for this function, 
                                e.g. <var>'hi'</var>, <var>2,8</var>, or <var>[10,-6,15]</var>
                            </p>
                        </div>
                        <div class="form-group">
                            {{ test_form.result.label_tag }} 
                            {{ test_form.result }}
                            <p class="help-text">
                                The valid Python object the function should return.
                            </p>
                        </div>
                        <input type="submit" value="add test" class="btn btn-success">
                    </form>
                    <h4>Existing Tests</h4>
                    <ul id="test-list" class="list-group">
                    {% for test, ex, result in tests %}
                        {% include "tutor/test-results.html" %}
                    {% endfor %}
                    </ul>
                </div>
            </div>
          <div class="tab-pane panel panel-default" id="history">
            <header class="panel-heading">
                <h2 class="panel-title">Revisions</h2>
            </header>
            <div class="panel-body">
              <table class="table table-striped table-sortable table-condensed">
                  <thead>
                      <tr>
                          <th>version</th>
                          <th class="text-center">date modified</th>
                          <th class="text-center">modified by</th>
                      </tr>
                  </thead>
                  <tbody>
                  {% for aq in history %}
                      <tr>
                          <td>{{aq.version}}</td>
                          <td class="text-center" data-sort-value="{{aq.modified.timestap}}">
                          {%if aq.version == question.instance.version %}
                              <abbr title="latest revisions">{{aq.modified}}</abbr>
                          {% else %}
                              <a href="/question/{{pk}}/diff/{{question.instance.version}},{{aq.version}}">{{aq.modified}}</a>
                          {% endif %}
                           </td>
                          <td class="text-center">{{aq.modifier}}</td>
                      </tr>
                  {% endfor %}
                  </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>
</div> <!--/row -->

{% endblock %}
